{% extends 'core/base.html' %}

{% block title %}Device Value Estimator{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <h1 class="mb-4">
            <i class="bi bi-calculator-fill text-primary"></i> Device Value Estimator
        </h1>
        <p class="lead mb-5">Discover the metal content and estimated recovery value of your device</p>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Search Form -->
                <div class="card shadow-lg mb-4">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-search"></i> Search for Your Device</h5>
                    </div>
                    <div class="card-body p-4">
                        <form method="post" action="{% url 'core:estimate' %}">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="{{ form.brand.id_for_label }}" class="form-label">Device Brand</label>
                                {{ form.brand }}
                                {% if form.brand.errors %}
                                    <div class="text-danger small mt-1">{{ form.brand.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="mb-3">
                                <label for="{{ form.model_name.id_for_label }}" class="form-label">Model Name</label>
                                {{ form.model_name }}
                                {% if form.model_name.errors %}
                                    <div class="text-danger small mt-1">{{ form.model_name.errors }}</div>
                                {% endif %}
                            </div>
                            <button type="submit" class="btn btn-primary w-100 btn-lg">
                                <i class="bi bi-calculator"></i> Estimate Value
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Results -->
                {% if device %}
                <div class="card shadow-lg border-success">
                    <div class="card-header bg-success text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-check-circle"></i> Device Found!</h5>
                    </div>
                    <div class="card-body p-4">
                        <h4 class="text-success mb-4">{{ device.brand }} {{ device.model_name }}</h4>
                        
                        <!-- Device Type Badge -->
                        <div class="mb-4">
                            <span class="badge bg-info fs-6">{{ device.get_device_type_display }}</span>
                        </div>

                        <!-- Metal Content -->
                        <h5 class="mb-3"><i class="bi bi-gem"></i> Metal Content:</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="card bg-warning bg-opacity-10 border-warning">
                                    <div class="card-body text-center">
                                        <i class="bi bi-coin text-warning" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Gold</h6>
                                        <p class="mb-0 fw-bold">{{ device.gold_mg }} mg</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-secondary bg-opacity-10 border-secondary">
                                    <div class="card-body text-center">
                                        <i class="bi bi-gem text-secondary" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Silver</h6>
                                        <p class="mb-0 fw-bold">{{ device.silver_mg }} mg</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-danger bg-opacity-10 border-danger">
                                    <div class="card-body text-center">
                                        <i class="bi bi-circle text-danger" style="font-size: 2rem;"></i>
                                        <h6 class="mt-2">Copper</h6>
                                        <p class="mb-0 fw-bold">{{ device.copper_mg }} mg</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Estimated Value -->
                        <div class="alert alert-success text-center py-4">
                            <h5 class="mb-2">Estimated Recovery Value</h5>
                            <h2 class="display-4 fw-bold text-success mb-2">₹{{ device.estimated_value }}</h2>
                            <p class="mb-0 text-muted">Points you'll earn: <strong>{{ device.get_point_value }}</strong></p>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-3 flex-wrap justify-content-center mt-4">
                            {% if user.is_authenticated %}
                            <a href="{% url 'core:dashboard' %}" class="btn btn-success btn-lg">
                                <i class="bi bi-recycle"></i> Recycle This Device
                            </a>
                            {% else %}
                            <a href="{% url 'core:register' %}" class="btn btn-success btn-lg">
                                <i class="bi bi-person-plus"></i> Sign Up to Recycle
                            </a>
                            {% endif %}
                            <a href="{% url 'core:locator' %}" class="btn btn-outline-success btn-lg">
                                <i class="bi bi-geo-alt"></i> Find Facilities
                            </a>
                        </div>
                    </div>
                </div>
                {% elif not_found %}
                <div class="card shadow-lg border-warning">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-search text-warning" style="font-size: 4rem;"></i>
                        <h4 class="mt-3 mb-3">Device Not Found</h4>
                        <p class="text-muted mb-4">We couldn't find this device in our database. Try searching with a different brand or model name, or contact us to add your device.</p>
                        <div class="d-flex gap-3 flex-wrap justify-content-center">
                            <a href="{% url 'core:estimate' %}" class="btn btn-primary">
                                <i class="bi bi-arrow-counterclockwise"></i> Try Again
                            </a>
                            <a href="{% url 'core:locator' %}" class="btn btn-outline-success">
                                <i class="bi bi-geo-alt"></i> Find Facilities
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Info Card -->
                <div class="card mt-4 bg-light border-0">
                    <div class="card-body">
                        <h6><i class="bi bi-info-circle text-primary"></i> How It Works</h6>
                        <ul class="mb-0">
                            <li>Enter your device brand and model</li>
                            <li>We calculate the precious metal content</li>
                            <li>You see the estimated recovery value in ₹</li>
                            <li>Recycle your device and earn points!</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Popular Devices -->
        <div class="row mt-5">
            <div class="col-12">
                <h3 class="text-center mb-4">Popular Devices in Our Database</h3>
                <p class="text-center text-muted mb-4">Try searching for these devices to see their value</p>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card text-center border-primary">
                    <div class="card-body">
                        <i class="bi bi-laptop text-primary" style="font-size: 2.5rem;"></i>
                        <h6 class="mt-2">Laptops</h6>
                        <small class="text-muted">Dell, HP, Lenovo, Apple</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card text-center border-success">
                    <div class="card-body">
                        <i class="bi bi-phone text-success" style="font-size: 2.5rem;"></i>
                        <h6 class="mt-2">Smartphones</h6>
                        <small class="text-muted">Apple, Samsung, OnePlus</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card text-center border-info">
                    <div class="card-body">
                        <i class="bi bi-tablet text-info" style="font-size: 2.5rem;"></i>
                        <h6 class="mt-2">Tablets</h6>
                        <small class="text-muted">iPad, Galaxy Tab</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card text-center border-warning">
                    <div class="card-body">
                        <i class="bi bi-pc-display text-warning" style="font-size: 2.5rem;"></i>
                        <h6 class="mt-2">Desktops</h6>
                        <small class="text-muted">Various brands</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
